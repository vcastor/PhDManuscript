% -*- coding: utf-8 -*-
\newpage
\section{Hartree-Fock Formalism}\label{HF_sec}

One of the earliest and most influential methods for addressing the quantum
mechanical complexity of many-electron systems is the Hartree-Fock approach,
developed independently by Douglas Hartree and Vladimir Fock~\cite{Hartree1928,
Fock1932}. Its core idea is to approximate the effect of electron-electron
repulsion by assuming that each electron moves independently in the average
field generated by all others. This Mean-Field Approximation greatly reduces
computational effort by replacing explicit inter-electronic interactions with an
effective potential.

To construct an approximate many-electron wavefunction, we begin with the
\emph{orbital approximation}, where the total wavefunction is written as a
product of single-electron functions (orbitals). This leads to the so-called
Hartree product:
%
\begin{align}
  \Psi = \prod_{i=1}^N \chi_i (\mathbf{r}_i) .
  \label{Aprox_Orb}
\end{align}

However, the Hartree product fails to satisfy the antisymmetry requirement
imposed by the Pauli exclusion principle: the total wavefunction of a system of
fermions must change sign upon exchange of any two
fermions. This ensures that no two electrons occupy the same quantum state. To
impose antisymmetry, a correct form of the wavefunction is given by a
Slater determinant, Equation~\ref{det_s} (or~\ref{det_s2} for compactness):

% \pagebreak
\clm{Slater Determinant}{}{
  {\footnotesize\baselineskip=4pt
  \begin{align}
    \ket{\Psi} = \frac{1}{\sqrt{N!}}
    \begin{vmatrix}
      \chi_{1}(\mathbf{x}_1) & \chi_{2}(\mathbf{x}_1) & \cdots & \chi_{N}(\mathbf{x}_1) \\
      \chi_{1}(\mathbf{x}_2) & \chi_{2}(\mathbf{x}_2) & \cdots & \chi_{N}(\mathbf{x}_2) \\
      \vdots & \vdots & \ddots & \vdots \\
      \chi_{1}(\mathbf{x}_N) & \chi_{2}(\mathbf{x}_N) & \cdots & \chi_{N}(\mathbf{x}_N)
    \end{vmatrix} ,
    \label{det_s}
  \end{align}
  %
  \begin{align}
    \ket{\Psi} = |\chi_{1}\chi_{2} \cdots \chi_{N} \rangle ,
    \label{det_s2}
  \end{align}

  \noindent where $\chi_n$ denotes a spin-orbital, and $\mathbf{x}_n$
  represents the combined spatial and spin coordinates of the $n$-th electron.
  The prefactor $\sfrac{1}{\sqrt{N!}}$ ensures normalisation.
  }
}

The \gls{HF} method approximates the electronic ground state by a wavefunction
in the form of a Slater determinant.
Within this ansatz, the total energy is
expressed as the expectation value of the Hamiltonian:

\begin{align}
  E = \langle \Psi_\mathrm{Slater} | \Ha | \Psi_\mathrm{Slater} \rangle .
  \label{HF_energy}
\end{align}

According to the variational principle, the determinant that minimises this
functional ---while its constituent spin-orbitals remain orthonormal--- gives the
best Slater determinant approximation to the true ground state. The resulting
optimisation problem can be written compactly as:

\begin{equation}
  \min_{\{\chi_i\}} \left\langle \Psi_\mathrm{Slater} \middle| \widehat{H} \middle| \Psi_\mathrm{Slater} \right\rangle.
\end{equation}

Enforcing the constraint that the spin-orbitals remain orthonormal: $\langle
\chi_i | \chi_j \rangle = \delta_{ij}$, we obtain a set of coupled
integro-differential equations, known as the Hartree-Fock equations:

\keq{Hartree-Fock Equations}{
  \begin{align}
    \widehat{F}\chi_{i}(\mathbf{x}_i)=\varepsilon_{i}\chi_{i}(\mathbf{x}_i),
  \end{align}
  {\small
  where $\widehat{F}$ is the Fock operator and $\varepsilon_i$ is the
  energy associated with the $i^{\mathrm{th}}$ spin-orbital $\chi_i$.}
}

\newpage
For the Fock operator, the repulsion between electrons is treated in an average
sense, resulting in the following expression:
%
\begin{align}
  \widehat{F} (i) = \widehat{h}(i) + \sum_{b=1}^N [\hat{J}_b (i) - \hat{K}_b (i)],
\end{align}

\noindent where $\widehat{h}(i)$ is the one-electron operator, accounting for
the kinetic energy of electron $i$ and its attraction to the nuclei. The terms
$\hat{J}_b$ and $\hat{K}_b$ denote the Coulomb and Exchange operators,
respectively. The Coulomb operator describes the classical electrostatic
repulsion between electron densities, while the Exchange operator arises purely
from the antisymmetry of the wavefunction and has no classical analogue.
%
\begin{gather}
  \widehat{h}(i) = -\sfrac{1}{2}\nabla^2_i -\sum_{A=1}^N\frac{Z_A}{r_{iA}}, \nonumber\\
  \widehat{J}_b (i) = \langle \chi_b(j) | r_{ij}^{-1} | \chi_b(j) \rangle, \quad
  \hat{K}_b (i) = \langle \chi_b(j) | r_{ij}^{-1} | \chi_a(j) \rangle.
\end{gather}

The operators $\widehat{J}$ and $\hat{K}$ constitute the bi-electronic
part of the Hamiltonian, and they are usually refered as the Coulomb and
Exchange integrals, as follows:
%
\begin{gather}
  J_{ij} \equiv \int\frac{\chi_i^\star(i)\chi_j^\star(j)\chi_i(i)\chi_j(j)}{r_{ij}}
    \dd\tau_i\dd\tau_j =
  \int\frac{\rho_i(i)\rho_j(j)}{r_{ij}}\dd\tau_i\dd\tau_j, \\
  K_{ij} \equiv \int\frac{\chi_i^\star(i)\chi_j^\star(j)\chi_i(j)\chi_j(i)}{r_{ij}}
    \dd\tau_i\dd\tau_j.
\end{gather}
%

\nt{
  The Coulomb and Exchange integrals can also be expressed in a more compact
  notation using Dirac bra-ket or Mulliken notation for two-electron integrals.
  \begin{align}
    J_{ij} = \langle ij | ij \rangle = (ii|jj) \\
    K_{ij} = \langle ij | ji \rangle = (ij|ji)
  \end{align}
}

\newpage
With the formalism developed above, we can now express the \gls{HF}
equations as:
%
\begin{align}
  \left(\widehat{h}(i) + \sum_b^N [\hat{J}_b (i) - \hat{K}_b (i)]\right)\chi_a (i) =
  \varepsilon_a \chi_a (i) \qquad \forall a \in (1,N),
  \label{HF_forall}
\end{align}

\noindent where $N$ refers to the number of occupied spin-orbitals, and
$N$ represents the total number of spin-orbitals in the system.

The resulting \gls{HF} equations are non-linear and integro-differential which
defies analytic solution. To address this, their solution is approached through
an iterative method known as the the self-consistent-field (\gls{SCF})
procedure. Starting from an initial guess for the spin-orbitals, the Fock
operator is constructed and its eigenfunctions are computed. These
eigenfunctions (updated orbitals) are then used to reconstruct the Fock
operator, the procedure continues until the orbitals from one cycle to the next
become effectively indistinguishable.

To render this iterative loop tractable for real molecules, Roothaan introduced
a matrix formulation in 1951~\cite{Roothaan1951}. Each spin-orbital is expanded
as a linear combination of predefined basis functions, transforming the
equations into a matrix eigenvalue problem, significantly reducing the
computational complexity of the \gls{SCF} procedure.

The basis set is typically normalised but not necessarily orthogonal,
allowing flexibility to describe molecular systems. Within this framework,
each spin-orbitals is constructed through a Linear Combination of Atomic Orbitals
(\gls{LCAO}) using $k$ predefined basis functions, as shown below:

\keq{}{
  \begin{align}
    \chi_{i} = \sum_{\nu}^k C_{\nu i}\phi_{\nu},
  \end{align}
  where $\phi_{\nu}$ represents the basis set functions, and $C_{\nu
  i}$ are the coefficients associated with each spin orbital.
}

\newpage
In theory, if the basis set were complete, this approach would yield the exact
solution. The choice of basis functions ---whether Gaussian-, or Slater-type
orbitals, or even plane waves--- depends on the system under study. These options
will be discussed in more detail in Section \ref{basis_set_sec}.

This new formulation is also called Roothaan-Hall, and can be
written in a generalised eigenvalue problem, 

\keq{Hartree-Fock-Roothaan-Hall Equation}{
  \begin{align}
    \mFock \mC = \mOverlap \mC \eps .
  \end{align}
  where $\mFock$ is the Fock matrix, $\mC$ is the coefficient
  matrix, $\mOverlap$ is the overlap matrix, and $\varepsilon$ is the orbital
  energy eigenvalues.
}

We still need to solve the eigenvalue problem, but now it is a linear algebra
problem without integro-differential equations. We can also use the
Löwdin Orthogonalisation to make the basis set orthogonal, which simplifies the
problem even further, as the next following equation shows~\cite{Mayer2003}~:

% \newpage
\follow{Löwdin Orthogonalisation}{
  
  Transforming the Fock matrix to an orthogonal basis set:
  \begin{align}
    \mFock' &= \mX^T \mFock \mX \nonumber \\
    \mFock' &= {\mOverlap^{-\frac12}}^T \mFock \mOverlap^{-\frac12}
  \end{align}

  Then, the Roothaan-Hall equations become:
  \begin{align}
    \mFock' \mC' = \mC' \varepsilon
  \end{align}

}

The computational cost of the \gls{HFRH} method is
$\mathcal{O}(N^3)$ with or without the Löwdin orthogonalisation. However,
solving the generalised eigenvalue problem $\mFock \mC = \mOverlap \mC \eps$
involves more internal operations (\eg, Cholesky decomposition of $\mOverlap$),
while solving the transformed problem $\mFock' \mC' = \mC' \varepsilon$ is
numerically more stable and faster, since $\mFock'$ is a symmetric matrix in an
orthonormal basis.

\newpage
In computational implementations, the \gls{HF} problem can be solved without
prior orthogonalisation, for example, using the \texttt{DSYGV} \subroutine from
\lapack~\cite{laug}, which handles generalised symmetric eigenvalue
problems. However, this routine internally reduces the problem to standard form
and ultimately calls \texttt{DSYEV} ---the same \subroutine we would use after
Löwdin orthogonalisation---. Performing the orthogonalisation explicitly avoids
redundant internal steps, offers greater control, and can improve efficiency
and numerical stability.

With all before mentioned, we can structure an algorithm to solve the
\gls{HF} problem for any given system, as we show in the next flowchart.

\vspace{.3cm}%
\begin{minipage}{0.45\textwidth}
  \input{scf_hf}
\end{minipage}
%
\begin{minipage}[t!]{0.45\textwidth}
  \vspace{0.5cm}%
  \hspace*{\parindent} As a first step, we require the coordinates of the system and the
  basis set. While the user typically provides the coordinates, most quantum
  chemistry packages include internal libraries of standard basis sets.

  \vspace{4.5cm}%

  \hspace*{\parindent} With this information, we compute the one-electron integrals ---the core
  Hamiltonian and overlap matrix--- and the two-electron integrals over the
  chosen basis functions.
\end{minipage}

\vspace{.3cm}%
Once the integrals are computed, the iterative procedure is initiated. This
continues until the convergence criterion is satisfied ---usually
defined in terms of energy difference and density matrix changes between
iterations---.

\newpage
However, it is important to emphasise that reaching convergence
does not imply the absolute correctness of the solution. As shown by Cancès and
Le Bris~\cite{Echenique2007}, the \gls{HF} model possesses intrinsic mathematical
limitations, and the \gls{SCF} method may converge to local rather than global minima
depending on the initial guess and system complexity. Moreover, Yang et
al.~\cite{Yang2009} demonstrated that additional iterations beyond convergence
do not yield improved accuracy, since the \gls{SCF} solution is inherently limited by
the chosen functional space and nonlinear nature of the eigenvalue problem.

Therefore, it is crucial to bear in mind that achieving full \gls{SCF}
convergence does not necessarily guarantee the correctness or accuracy of the
solution. Instead, a converged \gls{SCF} calculation should be regarded as a
computational approximation to the true solution, rather than a systematically
improvable and definitive result.

