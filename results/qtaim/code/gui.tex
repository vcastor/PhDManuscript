% -*- coding: utf-8 -*-

\begin{lstlisting}[language=tcl]
    # Read the TAPE10 ...
    # A polygon for every atom
    for {set iatom 0} {$iatom <= $natoms} {incr iatom} {
        # PolyData store the strucuture for every atom
        vtkPolyData $id.t10polydata.$iatom
        lappend VTK($id,ids) $id.t10polydata.$iatom
        $id.t10polydata.$iatom SetPoints $id.t10points
        $id.t10polydata.$iatom SetVerts $id.t10vert.$iatom

        # Sanity check
        if { [$id.t10polydata.$iatom GetNumberOfCells] < 4 } { continue }

        # Solid convex hull of the original points
        vtkDelaunay3D $id.del3d.$iatom
        # Code omitted for brevity ... 

        # Exterior faces; from an unstructured grid to a surface
        vtkDataSetSurfaceFilter $id.surf.$iatom
        # Set the connection for the surface ...

        # More polygons; subdivision
        vtkLoopSubdivisionFilter $id.subdiv.$iatom

        # Set the smoothing parameters ...
        vtkSmoothPolyDataFilter $id.t10smooth1.$iatom

        # Normal vectors [Generated by vtk]
        vtkPolyDataNormals $id.norm.$iatom
        $id.norm.$iatom SetInputConnection [$id.t10smooth.$iatom GetOutputPort]

        # Set the values for opacity and visual appearance
        [$id.t10actor.$iatom GetProperty] SetOpacity 0.4
        # ...
    }
\end{lstlisting}

